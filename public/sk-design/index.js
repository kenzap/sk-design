(function(){"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function _createForOfIteratorHelper(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==a.return||a.return()}finally{if(s)throw o}}}}const __=(e,...t)=>{let a=(e,t)=>(t.forEach(((t,a)=>{e=e.replace("%"+(a+1)+"$",t)})),e);return void 0===window.i18n||void 0===window.i18n.state.locale.values[e]?a(e,t):a(window.i18n.state.locale.values[e],t)},__esc=(e,t,...a)=>{let r=(e,t)=>(t.forEach(((t,a)=>{e=e.replace("%"+(a+1)+"$",t)})),e);return void 0===window.i18n||void 0===window.i18n.state.locale.values[e]?r(e,a):r(t(window.i18n.state.locale.values[e]),a)},__html=(e,...t)=>{if(0===(e=String(e)).length)return"";return __esc(e,(e=>e.replace(/[&<>'"]/g,(e=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&apos;",'"':"&quot;"}[e])))),...t)},hideLoader=()=>{let e=document.querySelector(".loader");e&&(e.style.display="none")},spaceID=()=>{let e=new URLSearchParams(window.location.search);return e.get("sid")?e.get("sid"):""},setCookie=(e,t,a)=>{let r="";if(a){let e=new Date;e.setTime(e.getTime()+24*a*60*60*1e3),r=";expires="+e.toUTCString()}document.cookie=e+"="+(escape(t)||"")+r+";path=/;domain=.kenzap.cloud"},getCookie=e=>{let t=e+"=",a=decodeURIComponent(document.cookie).split(";");for(let e=0;e<a.length;e++){let r=a[e];for(;" "==r.charAt(0);)r=r.substring(1);if(0==r.indexOf(t))return r.substring(t.length,r.length)}return""},checkHeader=()=>{let e=localStorage.hasOwnProperty("header")&&localStorage.hasOwnProperty("header-version")?localStorage.getItem("header-version"):0,t=window.location.hostname+"/"+spaceID()+"/"+getCookie("locale");return t!=getCookie("check")&&(e=0,console.log("refresh")),setCookie("check",t,5),e},headers={Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+getCookie("kenzap_api_key"),"Kenzap-Locale":getCookie("locale")?getCookie("locale"):"en","Kenzap-Header":checkHeader(),"Kenzap-Token":getCookie("kenzap_token"),"Kenzap-Sid":spaceID()},parseApiError=e=>{if(console.log(e),isNaN(e.code)){let t=e;try{t=JSON.stringify(t)}catch(e){}let a=new URLSearchParams;return a.append("cmd","report"),a.append("sid",spaceID()),a.append("token",getCookie("kenzap_token")),a.append("data",t),fetch("https://api-v1.kenzap.cloud/error/",{method:"post",headers:{Accept:"application/json","Content-type":"application/x-www-form-urlencoded"},body:a}),void alert("Can not connect to Kenzap Cloud")}if(401===e.code){if(-1!=window.location.href.indexOf("localhost"))return void alert(e.reason);location.href="https://auth.kenzap.com/?app=65432108792785&redirect="+window.location.href}else alert(e.reason)},onClick=(e,t)=>{if(document.querySelector(e))for(let a of document.querySelectorAll(e))a.removeEventListener("click",t,!0),a.addEventListener("click",t,!0)},onChange=(e,t)=>{if(document.querySelector(e))for(let a of document.querySelectorAll(e))a.removeEventListener("change",t,!0),a.addEventListener("change",t,!0)},simulateClick=e=>{let t=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window});e.dispatchEvent(t)},toast=e=>{if(!document.querySelector(".toast")){let e='\n        <div class="position-fixed bottom-0 p-2 m-4 end-0 align-items-center">\n            <div class="toast hide align-items-center text-white bg-dark border-0" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="3000">\n                <div class="d-flex">\n                    <div class="toast-body"></div>\n                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>\n                </div>\n            </div>\n        </div>';document.querySelector("body > div")&&document.querySelector("body > div").insertAdjacentHTML("afterend",e)}let t=new bootstrap.Toast(document.querySelector(".toast"));document.querySelector(".toast .toast-body").innerHTML=e,t.show()};var getProductId=function(){var e=new URLSearchParams(window.location.search);return e.get("id")?e.get("id"):""},priceFormat=function(e,t){switch(t=makeNumber(t),t=(Math.round(100*parseFloat(t))/100).toFixed(2),e.state.settings.currency_symb_loc){case"left":t=e.state.settings.currency_symb+t;break;case"right":t+=e.state.settings.currency_symb;break;case"left_space":t=e.state.settings.currency_symb+" "+t;break;case"right_space":t=t+" "+e.state.settings.currency_symb}return t},makeNumber=function(e){return e=e||0,e=parseFloat(e),e=Math.round(100*e)/100},onlyNumbers=function(e,t){if(document.querySelector(e)){var a,r=_createForOfIteratorHelper(document.querySelectorAll(e));try{for(r.s();!(a=r.n()).done;){a.value.addEventListener("keypress",(function(a){if(!t.includes(a.which)&&isNaN(String.fromCharCode(a.which))||32==a.which||document.querySelector(e).value.includes(String.fromCharCode(a.which))&&t.includes(a.which))return a.preventDefault(),!1}))}}catch(e){r.e(e)}finally{r.f()}}},escape$1=function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},unescape=function(e){return e=(e=(e=(e=(e=e.replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&quot;/g,'"')).replace(/&#39;/g,"'")).replace(/&amp;/g,"&")},degToRad=function(e){return(e-90)*Math.PI/180},HTMLContent=function(){return'\n  <div class="container p-sk-edit mt-4">\n    <div class="row">\n        <div class="col-lg-9 grid-margin grid-margin-lg-0 grid-margin-md-0 stretch-card">\n            <div class="sections" id="sections" role="tablist" style="width:100%;">\n\n                <div class="row">\n                    <div class="col-12 grid-margin stretch-card">\n                        <div class="card border-white shadow-sm p-sm-3">\n                            <div class="card-body">\n\n                                <div class="landing_status"></div>\n                                <input type="hidden" class="form-control" id="landing-slug" value="">\n\n                                <h4 id="sketch-h" class="card-title mb-4">'.concat(__html("Sketch"),'</h4>\n\n                                <div id="placeholders">\n\n                                    <div class="mb-3">\n                                        <label class="banner-descshort-l form-label d-none" for="desc">').concat(__html("Drawing"),'</label>\n                                        <div class="btn-group mb-3" role="group" aria-label="Basic radio toggle button group">\n                                            <input type="radio" class="btn-check" name="sketchmode" id="preview" autocomplete="off" checked>\n                                            <label class="btn btn-outline-primary" for="preview">').concat(__html("Upload"),'</label>\n\n                                            <input type="radio" class="btn-check" name="sketchmode" id="drawing" autocomplete="off">\n                                            <label class="btn btn-outline-primary" for="drawing">').concat(__html("Drawing"),'</label>\n\n                                            <input type="radio" class="btn-check" name="sketchmode" id="editing" autocomplete="off">\n                                            <label class="btn btn-outline-primary" for="editing">').concat(__html("Editing"),'</label>\n                                        </div>\n                                        <div class="drawing"></div>\n                                        <div class="clearfix"></div>\n                                    </div>\n\n                                    <div class="mb-3 mw">\n                                        <label class="banner-title-l form-label" for="p-test">').concat(__html("Input fields"),'</label>\n                                        <div class="input-fields">\n\n                                        </div>\n                                        \n                                        <p class="form-text"> </p>\n                                    </div>\n\n                                    <div class="mb-3 mw">\n                                        <label class="form-label" for="calc_price">').concat(__html("Calculate price"),'</label>\n                                        <select id="calc_price" class="form-select inp" >\n                                            <option value="default">').concat(__html("Default price"),'</option>\n                                            <option value="sketch">').concat(__html("By sketch"),'</option>\n                                            <option value="formula">').concat(__html("By formula"),'</option>\n                                            <option value="complex">').concat(__html("Complex product"),'</option>\n                                        </select>\n                                        <p class="form-text"> </p>\n                                    </div>\n\n                                    <div class="mb-3 mw">\n                                        <label class="form-label" for="formula">').concat(__html("Formula footage"),'</label>\n                                        <input id="formula" type="text" class="form-control inp" placeholder="').concat(__html("(A + B) * L"),'">\n                                        <p class="form-text formula-hint">').concat(__html("Square formula to calculate price."),'</p>\n                                    </div>\n\n                                    <div class="mb-3 mw">\n                                        <label class="form-label" for="formula_price">').concat(__html("Formula price"),'</label>\n                                        <input id="formula_price" type="text" class="form-control inp" placeholder="').concat(__html("B>1000?1.80:0.90"),'">\n                                        <p class="form-text formula_price-hint">').concat(__html("Price formula to add as an extra to the price."),'</p>\n                                    </div>\n\n                                    <div class="mb-3 mw">\n                                        <label class="form-label" for="p-test">').concat(__html("Test field"),'</label>\n                                        <input type="text" class="form-control inp" id="p-test" placeholder="').concat(__html("Test field.."),'">\n                                        <p class="form-text"> </p>\n                                    </div>\n\n                                    <div class="mb-3 mw">\n                                        <div class="list-wrapper">\n                                            <ul class="d-flex flex-column-reverse"> </ul>\n                                        </div>\n                                        <p class="form-text"> </p>\n                                    </div>\n\n                                </div>\n\n                                <div class="desc-repeater-cont">\n\n                                </div>\n\n                                <h4 id="parts-h" class="card-title mb-4">').concat(__html("Parts"),'</h4>\n                                <textarea id="parts" class="form-control mw" name="parts" rows="6" data-type="text" style="font-size:13px;font-family: monospace;"></textarea>\n                                <p class="form-text formula_price-hint">').concat(__html("Provide one product ID per line."),"</p>\n                            </div>\n                        </div>\n                    </div>\n\n                </div>\n\n            </div>\n        </div>\n    </div>\n  </div>\n\n  ")},Polyline=_createClass((function e(t){var a=this;_classCallCheck(this,e),_defineProperty(this,"draw",(function(e){if("drawing"==a.mode){var t='<g data-id="'.concat(a.id,'" data-type="polyline"><polyline data-id="').concat(a.id,'" points="').concat(a.polyPoints(e),'" style="stroke-width:').concat(a.style.stroke_width,";stroke:").concat(a.style.stroke,";fill:").concat(a.style.fill,';"></polyline></g>');return document.querySelector("#svg").insertAdjacentHTML("beforeend",t),a.drawCircle("start",e),a}})),_defineProperty(this,"setCoords",(function(e){if(document.querySelector('#svg polyline[data-id="'+a.id+'"]')){var t=document.querySelector('#svg polyline[data-id="'+a.id+'"]').getAttribute("points").split(" ");if("drawing"==e.mode&&(t.length>3&&(t=t.splice(0,2)),document.querySelector('#svg polyline[data-id="'+a.id+'"]')&&document.querySelector('#svg polyline[data-id="'+a.id+'"]').setAttribute("points",(t.join(" ")+" "+a.polyPoints(e.points)).trim())),"editing"==e.mode){switch(a.rect){case"start":t[0]=e.points[0].x,t[1]=e.points[0].y;break;case"end":t[2]=e.points[0].x,t[3]=e.points[0].y}document.querySelector('#svg polyline[data-id="'+a.id+'"]')&&document.querySelector('#svg polyline[data-id="'+a.id+'"]').setAttribute("points",t.join(" ")),document.querySelector('#svg rect[data-id="'+a.rect+a.id+'"]')&&(document.querySelector('#svg rect[data-id="'+a.rect+a.id+'"]').setAttribute("x",e.points[0].x-4),document.querySelector('#svg rect[data-id="'+a.rect+a.id+'"]').setAttribute("y",e.points[0].y-4))}}})),_defineProperty(this,"setEndCoords",(function(e){if(document.querySelector('#svg polyline[data-id="'+a.id+'"]')){a.setCoords(e),a.drawCircle("end",e.points);var t=document.querySelector('#svg polyline[data-id="'+a.id+'"]').getAttribute("points").split(" ");t[0]==t[2]&&t[1]==t[3]&&document.querySelector('#svg g[data-id="'+a.id+'"]').remove()}})),_defineProperty(this,"drawCircle",(function(e,t){var r='<rect data-id="'.concat(e+a.id,'" x="').concat(t[0].x-4,'" y="').concat(t[0].y-4,'" class="po" data-type="polyline" data-rect="').concat(e,'" width="8" height="8" rx="8" style="stroke-width:2px;stroke:').concat(a.style.stroke,';fill:rgba(255,255,255,1);" />');document.querySelector('#svg g[data-id="'+a.id+'"]')&&document.querySelector('#svg g[data-id="'+a.id+'"]').insertAdjacentHTML("beforeend",r)})),_defineProperty(this,"polyPoints",(function(e){return e.reduce((function(e,t){return e+t.x+" "+t.y+" "}),"").trim()})),_defineProperty(this,"setSVGCoords",(function(e){return a})),_defineProperty(this,"getID",(function(){return a.id})),_defineProperty(this,"genID",(function(e){for(var t="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<e;r++)t+=a.charAt(Math.floor(Math.random()*a.length));return t})),this.data=t,this.id=t.id?t.id:this.genID(6),this.mode=t.mode?t.mode:"drawing",this.rect=t.rect?t.rect:"",this.selected=null,this.style={stroke_width:"3px",stroke:"#00F",fill:"rgba(255, 255, 255, 0)"},this.draw(t.points)})),Arc=_createClass((function e(t){var a=this;_classCallCheck(this,e),_defineProperty(this,"draw",(function(e){if("drawing"==a.mode){var t='<g data-id="'.concat(a.id,'" data-type="arc" data-params="').concat(escape$1(JSON.stringify(e.params)),'" ><path data-id="').concat(a.id,'" fill="transparent" d="').concat(e.points,'" style="stroke-width:').concat(a.style.stroke_width,";stroke:").concat(a.style.stroke,";fill:").concat(a.style.fill,';"></path></g>');document.querySelector("#svg").insertAdjacentHTML("beforeend",t),a.drawCircle("start",e),a.drawCircle("end",e)}if("editing"==a.mode){var r=JSON.parse(unescape(document.querySelector('#svg g[data-id="'+a.id+'"]').dataset.params)),n=r.x-e.params.x,o=r.y-e.params.y,i=180*Math.atan2(n,o)/Math.PI;i=i<0?-1*i:360-i,"start"==a.rect&&(r.startAngle=i),"end"==a.rect&&(r.endAngle=i),a.data.points=a.describeArc(r.x,r.y,r.radius,r.startAngle,r.endAngle),document.querySelector('#svg g[data-id="'+a.id+'"] path').setAttribute("d",a.data.points),document.querySelector('#svg g[data-id="'+a.id+'"]').dataset.params=escape$1(JSON.stringify(r)),document.querySelector('#svg g[data-id="'+a.id+'"] rect[data-rect="'+a.rect+'"').setAttribute("x",r.x+e.params.radius*Math.cos(a.degToRad(i))-4),document.querySelector('#svg g[data-id="'+a.id+'"] rect[data-rect="'+a.rect+'"').setAttribute("y",r.y+e.params.radius*Math.sin(a.degToRad(i))-4)}return a})),_defineProperty(this,"drawCircle",(function(e,t){var r=0;"start"==e&&(r=a.degToRad(t.params.startAngle)),"end"==e&&(r=a.degToRad(t.params.endAngle));var n=t.params.x+t.params.radius*Math.cos(r)-4,o=t.params.y+t.params.radius*Math.sin(r)-4,i='<rect data-id="'.concat(e+a.id,'" x="').concat(n,'" y="').concat(o,'" data-type="arc" class="po" data-rect="').concat(e,'" width="8" height="8" rx="8" style="stroke-width:2px;stroke:').concat(a.style.stroke,';fill:rgba(255,255,255,1);" />');document.querySelector('#svg g[data-id="'+a.id+'"]')&&document.querySelector('#svg g[data-id="'+a.id+'"]').insertAdjacentHTML("beforeend",i)})),_defineProperty(this,"polarToCartesian",(function(e,t,r,n){var o=a.degToRad(n);return{x:e+r*Math.cos(o),y:t+r*Math.sin(o)}})),_defineProperty(this,"describeArc",(function(e,t,r,n,o){var i=o;i-n==360&&(o=359);var s=a.polarToCartesian(e,t,r,o),l=a.polarToCartesian(e,t,r,n),c=o-n<=180?"0":"1";if(i-n==360)var d=["M",s.x,s.y,"A",r,r,0,c,0,l.x,l.y,"z"].join(" ");else d=["M",s.x,s.y,"A",r,r,0,c,0,l.x,l.y].join(" ");return d})),_defineProperty(this,"degToRad",(function(e){return(e-90)*Math.PI/180})),_defineProperty(this,"genID",(function(e){for(var t="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<e;r++)t+=a.charAt(Math.floor(Math.random()*a.length));return t})),_defineProperty(this,"getPath",(function(){return a.points})),_defineProperty(this,"getID",(function(){return a.id})),this.data=t,this.id=t.id?t.id:this.genID(6),this.mode=t.mode?t.mode:"drawing",this.rect=t.rect?t.rect:"",this.style={stroke_width:"3px",stroke:"#ff007d",fill:"rgba(255, 255, 255, 0)"},this.selected=null,this.data.points=this.describeArc(t.params.x,t.params.y,t.params.radius,t.params.startAngle,t.params.endAngle),this.draw(this.data)})),CDN="https://kenzap-sites.oss-ap-southeast-1.aliyuncs.com/",_this={init:function(){_this.getData()},state:{ajaxQueue:0,settings:{},sk_settings:{},firstLoad:!0,product:{input_fields:[]},sketch:{mode:"preview",type:"",mousedown:!1,last:{id:null},angle:!1}},getData:function(){var e=getProductId();spaceID(),fetch("https://api-v1.kenzap.cloud/",{method:"post",headers:headers,body:JSON.stringify({query:{user:{type:"authenticate",fields:["avatar"],token:getCookie("kenzap_token")},product:{type:"find",key:"ecommerce-product",id:e,fields:["_id","id","test","input_fields","formula","formula_price","calc_price","parts","updated"]},settings:{type:"get",key:"ecommerce-settings",fields:["currency","currency_symb","currency_symb_loc","tax_calc","tax_auto_rate","tax_rate","tax_display"]},sk_settings:{type:"get",key:"sk-settings",fields:["price"]},locale:{type:"locale",source:["extension"],key:"sk-design"}}})}).then((function(e){return e.json()})).then((function(e){if(hideLoader(),e.success){if(e.success){if(_this.state.settings=e.settings,_this.state.sk_settings=e.sk_settings,_this.state.product=e.product,console.log(_this.state.sk_settings),0==e.product.length)return;document.querySelector("#contents").insertAdjacentHTML("beforeend",HTMLContent()),_this.loadDrawing(e.product),_this.renderPage(e.product),_this.initListeners()}}else parseApiError(e)})).catch((function(e){parseApiError(e)}))},renderPage:function renderPage(product){var d=document;_this.state.sketch.mode="drawing",product.input_fields&&(simulateClick(document.querySelector("#editing")),product.input_fields.forEach((function(e){var t=_this.structInputRow(e);if(document.querySelector("#field"+e.id)||document.querySelector(".input-fields").insertAdjacentHTML("beforeend",t),!document.querySelector('#svg g[data-id="'+e.id+'"]'))switch(e.type){case"polyline":var a=e.points.split(" ");_this.state.sketch.polyline=new Polyline({points:[{x:a[0],y:a[1]}],mode:"drawing",id:e.id}),_this.state.sketch.polyline.setCoords({points:[{x:a[2],y:a[3]}],mode:"drawing"}),_this.state.sketch.polyline.setEndCoords({points:[{x:a[2],y:a[3]}],mode:"drawing"});break;case"arc":e.params="string"==typeof e.params?{}:e.params,_this.state.sketch.arc=new Arc({params:{x:e.params.x,y:e.params.y,radius:e.params.radius,startAngle:e.params.startAngle,endAngle:e.params.endAngle},mode:"drawing",id:e.id})}})),_this.refreshFields()),_this.listeners.inputFieldListeners(),_this.state.sketch.polyline=null,d.querySelector("#calc_price").value=product.calc_price?product.calc_price:"default",d.querySelector("#formula").value=product.formula,d.querySelector("#formula_price").value=product.formula_price,document.querySelector("#formula").addEventListener("keyup",(function(e){var formula=e.currentTarget.value,labels="COATING ";formula=formula.replaceAll("COATING",1);var _iterator=_createForOfIteratorHelper(document.querySelectorAll(".input-fields > div")),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var div=_step.value;labels+=div.querySelector(".field-label").value+" ",formula=formula.replaceAll(div.querySelector(".field-label").value,parseFloat(div.querySelector(".field-default").value))}}catch(e){_iterator.e(e)}finally{_iterator.f()}labels=labels.trim();var result=0;try{document.querySelector(".formula-hint").innerHTML="",result=eval(formula),document.querySelector("#formula").setCustomValidity("")}catch(e){document.querySelector("#formula").setCustomValidity(__("Invalid formula")),document.querySelector(".formula-hint").innerHTML=__("Invalid formula. Use one of the following letters only: "+labels)}document.querySelector("#formula").parentElement.classList.add("was-validated"),result>0&&(document.querySelector(".formula-hint").innerHTML=__("Result: <b>"+result/1e6+" ㎡</b> based on the input fields default values",result))})),document.querySelector("#formula_price").addEventListener("keyup",(function(e){var formula=e.currentTarget.value,labels="COATING ";formula=formula.replaceAll("COATING",1);var _iterator2=_createForOfIteratorHelper(_this.state.sk_settings.price),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var price=_step2.value;0!=price.id.length&&(labels+=price.id+" ",formula=formula.replaceAll(price.id,parseFloat(price.price)))}}catch(e){_iterator2.e(e)}finally{_iterator2.f()}var _iterator3=_createForOfIteratorHelper(document.querySelectorAll(".input-fields > div")),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var div=_step3.value;labels+=div.querySelector(".field-label").value+" ",formula=formula.replaceAll(div.querySelector(".field-label").value,parseFloat(div.querySelector(".field-default").value))}}catch(e){_iterator3.e(e)}finally{_iterator3.f()}labels=labels.trim();var result=0;try{document.querySelector(".formula_price-hint").innerHTML="",result=eval(formula),document.querySelector("#formula_price").setCustomValidity("")}catch(e){document.querySelector("#formula_price").setCustomValidity(__("Invalid price formula")),document.querySelector(".formula_price-hint").innerHTML=__("Invalid price formula. Use one of the following letters only: "+labels)}document.querySelector("#formula_price").parentElement.classList.add("was-validated"),result>0&&(document.querySelector(".formula_price-hint").innerHTML=__("Result: <b>"+priceFormat(_this,result)+"</b> based on the input fields default values",result))})),product.parts||(product.parts=[]),Array.isArray(product.parts)||(product.parts=[]),product.parts.forEach((function(e){document.querySelector("#parts").value+=e.id+"\n"}))},initListeners:function(){_this.state.firstLoad&&(onClick(".btn-save",_this.listeners.saveProduct),onClick(".p-modal .btn-primary",_this.listeners.modalSuccessBtn),_this.state.firstLoad=!1)},listeners:{editBlock:function(e){e.preventDefault();var t=document.querySelector(".add-mix-block");t.dataset.action="edit",t.dataset.index=e.currentTarget.dataset.index,setTimeout((function(){return simulateClick(t)}),10),console.log("editBlock")},inputFieldListeners:function(e){onClick(".remove-input-field",_this.listeners.removeInputFields),onlyNumbers(".field-default",[8,46]),onlyNumbers(".field-min",[8,46]),onlyNumbers(".field-max",[8,46])},removeBlock:function(e){e.preventDefault(),confirm(__("Remove entire block?"))&&e.currentTarget.parentNode.parentNode.remove(),console.log("removeBlock")},removeInputFields:function(e){if(confirm(__("Remove row?"))){var t=e.currentTarget.dataset.id;console.log("remove"+t),document.querySelector('#svg g[data-id="'+t+'"]')&&document.querySelector('#svg g[data-id="'+t+'"]').remove(),document.querySelector(".input-fields #field"+t)&&document.querySelector(".input-fields #field"+t).remove(),document.querySelector('.svg-input[data-id="'+t+'"]')&&document.querySelector('.svg-input[data-id="'+t+'"]').remove()}},inputFieldChange:function(e){console.log(e.currentTarget.value);var t=e.currentTarget.parentElement.parentElement.id.replace("field","");document.querySelector('.svg-input[data-id="'+t+'"] > label').innerHTML=e.currentTarget.value},saveProduct:function(e){e.preventDefault(),setTimeout((function(){var e,t={input_fields:[]},a=_createForOfIteratorHelper(document.querySelectorAll(".input-fields > div"));try{for(a.s();!(e=a.n()).done;){var r=e.value,n={};n.id=r.id.replace("field",""),n.points=r.dataset.points,n.type=r.dataset.type,n.params="arc"==n.type?JSON.parse(unescape(r.dataset.params)):{},n.label=r.querySelector(".field-label").value,n.default=parseFloat(r.querySelector(".field-default").value),n.min=parseFloat(r.querySelector(".field-min").value),n.max=parseFloat(r.querySelector(".field-max").value),t.input_fields.push(n)}}catch(e){a.e(e)}finally{a.f()}t.calc_price=document.querySelector("#calc_price").value,t.formula=document.querySelector("#formula").value.trim(),t.formula_price=document.querySelector("#formula_price").value.trim(),t.parts=[],console.log(document.querySelector("#parts")),document.querySelector("#parts").value.trim().split("\n").forEach((function(e){t.parts.push({id:e})})),console.log(t);var o=getProductId(),i=spaceID();fetch("https://api-v1.kenzap.cloud/",{method:"post",headers:headers,body:JSON.stringify({query:{product:{type:"update",key:"ecommerce-product",id:o,sid:i,data:t}}})}).then((function(e){return e.json()})).then((function(e){e.success?_this.uploadImages():parseApiError(e)})).catch((function(e){parseApiError(e)}))}),1e3)},openImage:function(e){e.preventDefault(),simulateClick(document.querySelector(".aif-"+e.currentTarget.dataset.index))},previewImage:function(e){e.preventDefault();var t=e.currentTarget;if(t.files&&t.files[0]){if("image/jpeg"!=t.files[0].type&&"image/jpg"!=t.files[0].type&&"image/png"!=t.files[0].type)return void toast(__("Please provide image in JPEG format"));if(t.files[0].size>5e6)return void toast(__("Please provide image less than 5 MB in size!"));var a=t.dataset.index,r=new FileReader;r.onload=function(e){document.querySelector(".images-"+a).setAttribute("src",e.currentTarget.result)},r.readAsDataURL(t.files[0]),e.currentTarget.parentElement.querySelector(".remove").classList.remove("hd")}},removeImage:function(e){var t=e.currentTarget.parentElement.dataset.index;document.querySelector(".aif-"+t).value="",document.querySelector(".images-"+t).setAttribute("src","https://account.kenzap.com/images/placeholder.jpg"),e.currentTarget.classList.add("hd")},sketchMode:function(e){_this.state.sketch.mode=e.currentTarget.id,"preview"==e.currentTarget.id?document.querySelector("#svg").style.zIndex="-2":document.querySelector("#svg").style.zIndex="2",document.querySelector(".sketch-cont").dataset.mode=e.currentTarget.id},modalSuccessBtn:function(e){console.log("calling modalSuccessBtnFunc"),_this.listeners.modalSuccessBtnFunc(e)},stockManagement:function(e){var t,a=_createForOfIteratorHelper(document.querySelectorAll(".stock-cont"));try{for(a.s();!(t=a.n()).done;){var r=t.value;e.currentTarget.checked?r.classList.remove("d-none"):r.classList.add("d-none"),e.currentTarget.value=e.currentTarget.checked?"1":"0"}}catch(e){a.e(e)}finally{a.f()}},modalSuccessBtnFunc:null},getNextLabel:function(e){var t,a=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],r=["α","β","γ","δ","ε","ζ","η","θ","ι","κ","λ"],n=_createForOfIteratorHelper(document.querySelectorAll('.input-fields > div .field-label[data-type="polyline"]'));try{var o=function(){var e=t.value;a=a.filter((function(t){return t!==e.value}))};for(n.s();!(t=n.n()).done;)o()}catch(e){n.e(e)}finally{n.f()}var i,s=_createForOfIteratorHelper(document.querySelectorAll('.input-fields > div .field-label[data-type="arc"]'));try{var l=function(){var e=i.value;r=r.filter((function(t){return t!==e.value}))};for(s.s();!(i=s.n()).done;)l()}catch(e){s.e(e)}finally{s.f()}return"polyline"==e?a:r},structInputRow:function(e){var t=_this.getNextLabel(e.type),a="";return t.forEach((function(t){a+='<option value="'+t+'" '+(e.label==t?"selected":"")+">"+t+"</option>"})),'\n                <div id="field'.concat(e.id,'" class="d-flex flex-row bd-highlight mb-0" data-type="').concat(e.type,'" data-points="').concat(e.points,'" data-params="').concat(escape$1(JSON.stringify(e.params?e.params:{})),'">\n                    <div class="me-3" >\n                        <select class="form-select field-label" style="width:64px" data-type="').concat(e.type,'" aria-label="Default select example">\n                            ').concat(a,'\n                        </select>\n                        <p class="form-text">').concat(__("label"),'</p>\n                    </div>\n                    <div class="me-3">\n                        <input type="text" class="form-control field-default" placeholder="').concat(__("0"),'" value="').concat(e.default,'"></input>\n                        <p class="form-text">').concat(__("default value"),'</p>\n                    </div>\n                    <div class="me-3">\n                        <input type="text" class="form-control field-min" placeholder="').concat(__("0"),'" value="').concat(e.min,'"></input>\n                        <p class="form-text">').concat(__("min value"),'</p>\n                    </div>\n                    <div class="me-3">\n                        <input type="text" class="form-control field-max" placeholder="').concat(__("1000"),'" value="').concat(e.max,'"></input>\n                        <p class="form-text">').concat(__("max value"),'</p>\n                    </div>\n                    <a href="javascript:void(0);" onclick="javascript:;">\n                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#ff0079" class="remove-input-field bi bi-x-circle mt-2" data-id="').concat(e.id,'" viewBox="0 0 16 16">\n                            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"></path>\n                            <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"></path>\n                        </svg>\n                    </a>\n                </div>\n            ')},loadDrawing:function(e){for(var t=document,a=getProductId(),r=spaceID(),n="",o=0;o<1;o++){n+='\n          <div class="p-img-cont sketch-cont float-start" data-mode="preview" style="max-width:100%;">\n            <div data-index="sketch'.concat(o,'" class="pe-3" style="position: relative;">\n              <img class="p-img images-sketch').concat(o,'" data-index="sketch').concat(o,'" src="').concat("https://account.kenzap.com/images/placeholder.jpg",'" style="max-width:500px;max-height:500px;"/>\n              <svg id="svg" xmlns="http://www.w3.org/2000/svg" style="width: 100%; height: 100%;display: block; position: absolute; top: 0; left: 0; z-index: -2;">\n                \n              </svg>\n              <span class="remove po hd" title="').concat(__("Remove"),'">×</span>\n              <div class="labels">\n\n              </div>\n            </div>\n            <input type="file" name="img[]" data-type="search" data-index="sketch').concat(o,'" class="sketchfile aif-sketch').concat(o,' d-none">\n          </div>')}t.querySelector(".drawing").innerHTML=n,onClick(".drawing img",_this.listeners.openImage),onClick(".drawing .remove",_this.listeners.removeImage),onChange(".drawing .sketchfile",_this.listeners.previewImage),onClick('[name="sketchmode"]',_this.listeners.sketchMode),t.querySelector("#svg").addEventListener("mousedown",(function(e){if(e.preventDefault(),_this.state.sketch.mousedown=!0,"drawing"==_this.state.sketch.mode&&_this.state.sketch.requestAngle)return _this.state.sketch.arc=new Arc({params:{x:e.offsetX,y:e.offsetY,radius:25,startAngle:60,endAngle:170},mode:"drawing"}),void(_this.state.sketch.type="arc");"drawing"==_this.state.sketch.mode&&(_this.state.sketch.polyline=new Polyline({points:[{x:e.offsetX,y:e.offsetY}],mode:"drawing"}),_this.state.sketch.type="polyline"),"editing"==_this.state.sketch.mode&&"polyline"==_this.state.sketch.type&&(_this.state.sketch.polyline=new Polyline({points:[{x:e.offsetX,y:e.offsetY}],mode:"editing",id:_this.state.sketch.last.id,rect:_this.state.sketch.rect}),_this.state.sketch.type="polyline"),"editing"==_this.state.sketch.mode&&"arc"==_this.state.sketch.type&&(_this.state.sketch.arc=new Arc({params:{x:e.offsetX,y:e.offsetY,radius:25,startAngle:60,endAngle:170},mode:"editing",id:_this.state.sketch.last.id,rect:_this.state.sketch.rect}),_this.state.sketch.type="arc")})),t.querySelector("#svg").addEventListener("mousemove",(function(e){e.preventDefault(),_this.state.sketch.polyline&&"drawing"==_this.state.sketch.mode&&"polyline"==_this.state.sketch.type&&_this.state.sketch.polyline.setCoords({points:[{x:e.offsetX,y:e.offsetY}],mode:"drawing"}),_this.state.sketch.polyline&&"editing"==_this.state.sketch.mode&&"polyline"==_this.state.sketch.type&&_this.state.sketch.polyline.setCoords({points:[{x:e.offsetX,y:e.offsetY}],mode:"editing"}),_this.state.sketch.arc&&"editing"==_this.state.sketch.mode&&"arc"==_this.state.sketch.type&&(_this.state.sketch.arc=new Arc({params:{x:e.offsetX,y:e.offsetY,radius:25,startAngle:60,endAngle:170},mode:"editing",id:_this.state.sketch.last.id,rect:_this.state.sketch.rect}),_this.state.sketch.type="arc")})),t.querySelector("#svg").addEventListener("mouseup",(function(e){if(e.preventDefault(),_this.state.sketch.mousedown=!1,_this.state.sketch.polyline&&"drawing"==_this.state.sketch.mode&&_this.state.sketch.polyline.setEndCoords({points:[{x:e.offsetX,y:e.offsetY}],mode:"drawing"}),!_this.state.sketch.polyline&&!_this.state.sketch.arc||"drawing"!=_this.state.sketch.mode&&"editing"!=_this.state.sketch.mode||_this.refreshFields(),_this.state.sketch.polyline=null,_this.state.sketch.arc=null,document.querySelector("#svg rect")){var t,a=_createForOfIteratorHelper(document.querySelectorAll("#svg rect"));try{for(a.s();!(t=a.n()).done;){var r=t.value;r.onmouseover=function(e){_this.state.sketch.mousedown||(_this.state.sketch.rect=e.currentTarget.dataset.rect,_this.state.sketch.last.id=e.currentTarget.dataset.id.replace("start","").replace("end",""),_this.state.sketch.type=e.currentTarget.dataset.type)},r.onmouseleave=function(e){_this.state.sketch.mousedown||(_this.state.sketch.rect=null)}}}catch(e){a.e(e)}finally{a.f()}}if(document.querySelector("#svg polyline")){var n,o=_createForOfIteratorHelper(document.querySelectorAll("#svg polyline"));try{for(o.s();!(n=o.n()).done;){n.value.onmouseover=function(e){_this.state.sketch.mousedown||(_this.state.sketch.last.id=e.currentTarget.dataset.id)}}}catch(e){o.e(e)}finally{o.f()}}if(document.querySelector("#svg path")){var i,s=_createForOfIteratorHelper(document.querySelectorAll("#svg path"));try{for(s.s();!(i=s.n()).done;){i.value.onmouseover=function(e){_this.state.sketch.mousedown||(_this.state.sketch.last.id=e.currentTarget.dataset.id)}}}catch(e){s.e(e)}finally{s.f()}}})),document.querySelector("#svg").onmouseover=function(e){_this.state.sketch.hover=!0},document.querySelector("#svg").onmouseleave=function(e){_this.state.sketch.hover=!1};var i=function(e){65==e.which&&"drawing"==_this.state.sketch.mode&&(_this.state.sketch.requestAngle=!0,console.log("REQUESTING"),setTimeout((function(){_this.state.sketch.requestAngle=!1}),2e3)),8!=e.which&&27!=e.which||"drawing"!=_this.state.sketch.mode||!_this.state.sketch.polyline||(console.log("removing"),document.querySelector('#svg g[data-id="'+_this.state.sketch.polyline.getID()+'"]').remove()),8==e.which&&"editing"==_this.state.sketch.mode&&_this.state.sketch.hover&&(document.querySelector('#svg g[data-id="'+_this.state.sketch.last.id+'"]')&&document.querySelector('#svg g[data-id="'+_this.state.sketch.last.id+'"]').remove(),document.querySelector(".input-fields #field"+_this.state.sketch.last.id)&&document.querySelector(".input-fields #field"+_this.state.sketch.last.id).remove(),document.querySelector('.svg-input[data-id="'+_this.state.sketch.last.id+'"]')&&document.querySelector('.svg-input[data-id="'+_this.state.sketch.last.id+'"]').remove())};document.removeEventListener("keydown",i,!0),document.addEventListener("keydown",i,!0);for(var s=0;s<1;s++){var l=CDN+"/S"+r+"/sketch-"+a+"-"+(parseInt(s)+1)+"-500x500.jpeg?"+e.updated;setTimeout((function(a,r,n){var o=!0;if(void 0!==e.img&&(e.img[n]||(o=!1)),o){var i=new Image;i.onload=function(){t.querySelector(r+n).setAttribute("src",a),t.querySelector(r+n).parentElement.querySelector(".remove").classList.remove("hd")},i.src=a}}),300,l,".images-sketch",s)}},refreshFields:function(){var e="";if(document.querySelector("#svg g")){var t,a=_createForOfIteratorHelper(document.querySelectorAll("#svg g"));try{for(a.s();!(t=a.n()).done;){var r=t.value,n=r.dataset.id,o={},i=void 0,s=void 0,l=document.querySelector("#field"+n+" .field-label")?document.querySelector("#field"+n+" .field-label").value:_this.getNextLabel(r.dataset.type)[0];switch(r.dataset.type){case"polyline":var c=(o={id:n,label:l,default:0,min:0,max:0,type:r.dataset.type,params:{},points:r.querySelector("polyline").getAttribute("points")}).points.split(" ");i=(parseFloat(c[0])+parseFloat(c[2]))/2,s=(parseFloat(c[1])+parseFloat(c[3]))/2,e+='\n                    <div class="svg-input m-2 lable-line" style="left:'.concat(i,"px;top:").concat(s,'px;" data-id="').concat(o.id,'">\n                        <label for="input').concat(o.label,'">').concat(o.label,"</label>\n                    </div>\n                    ");break;case"arc":var d=(o={id:n,label:l,default:0,min:0,max:0,type:r.dataset.type,params:JSON.parse(unescape(r.dataset.params)),points:r.querySelector("path").getAttribute("d")}).params.startAngle+(o.params.endAngle-o.params.startAngle)/2;i=o.params.x+o.params.radius/2+2*o.params.radius*Math.cos(degToRad(d))+5,s=o.params.y+o.params.radius/2+2*o.params.radius*Math.sin(degToRad(d))-5,e+='\n                    <div class="svg-input m-2 lable-angle" style="left:'.concat(i,"px;top:").concat(s,'px;" data-id="').concat(o.id,'">\n                        <label for="input').concat(o.label,'">').concat(o.label,"°</label>\n                    </div>\n                    ")}var u=_this.structInputRow(o);document.querySelector("#field"+n)?(document.querySelector("#field"+n).setAttribute("data-points",o.points),document.querySelector("#field"+n).setAttribute("data-params",escape$1(JSON.stringify(o.params)))):document.querySelector(".input-fields").insertAdjacentHTML("beforeend",u),_this.listeners.inputFieldListeners()}}catch(e){a.e(e)}finally{a.f()}}document.querySelector(".labels").innerHTML=e,onChange(".field-label",_this.listeners.inputFieldChange)},uploadImages:function(){document.querySelector(".imgupnote")&&document.querySelector(".imgupnote").remove();var e,t=0,a=_createForOfIteratorHelper(document.querySelectorAll(".sketchfile"));try{for(a.s();!(e=a.n()).done;){var r=e.value;t+=1;var n=getProductId(),o=spaceID(),i=r.files[0];if(void 0!==i){var s=new FormData;s.append("id",n),s.append("sid",o),s.append("pid",n),s.append("key","image"),s.append("sizes","1000|500x500|250x250|100x100"),s.append("file",i),s.append("slug","sketch-"+n+"-"+t),s.append("token",getCookie("kenzap_token")),i.value="",_this.state.ajaxQueue+=1,fetch("https://api-v1.kenzap.cloud/upload/",{body:s,method:"post"}).then((function(e){return e.json()})).then((function(e){_this.state.ajaxQueue-=1,e.success&&0==_this.state.ajaxQueue&&(toast(__("Sketch updated")),hideLoader())}))}}}catch(e){a.e(e)}finally{a.f()}0==_this.state.ajaxQueue&&(toast(__("Product updated")),hideLoader())}};_this.init()})();
