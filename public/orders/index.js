!function(){"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,n=new Array(e);a<e;a++)n[a]=t[a];return n}function n(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return a(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,d=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){d=!0,i=t},f:function(){try{s||null==n.return||n.return()}finally{if(d)throw i}}}}const r=()=>{let t=document.querySelector(".loader");t&&(t.style.display="none")},o=t=>{let e=new URLSearchParams(window.location.search),a=e.get("sid")?e.get("sid"):"",n=-1==t.indexOf("?")?"?sid="+a:"&sid="+a;return t+n},i=()=>{let t=new URLSearchParams(window.location.search);return t.get("sid")?t.get("sid"):""},s=t=>{let e=t+"=",a=decodeURIComponent(document.cookie).split(";");for(let t=0;t<a.length;t++){let n=a[t];for(;" "==n.charAt(0);)n=n.substring(1);if(0==n.indexOf(e))return n.substring(e.length,n.length)}return""},d={Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+s("kenzap_api_key"),"Kenzap-Locale":s("locale")?s("locale"):"en","Kenzap-Header":(()=>{let t=localStorage.hasOwnProperty("header")&&localStorage.hasOwnProperty("header-version")?localStorage.getItem("header-version"):0,e=window.location.hostname+"/"+i()+"/"+s("locale");return e!=s("check")&&(t=0,console.log("refresh")),((t,e,a)=>{let n="";if(a){let t=new Date;t.setTime(t.getTime()+24*a*60*60*1e3),n=";expires="+t.toUTCString()}document.cookie=t+"="+(escape(e)||"")+n+";path=/;domain=.kenzap.cloud"})("check",e,5),t})(),"Kenzap-Token":s("kenzap_token"),"Kenzap-Sid":i()},c=t=>{if(console.log(t),isNaN(t.code)){let e=t;try{e=JSON.stringify(e)}catch(t){}let a=new URLSearchParams;return a.append("cmd","report"),a.append("sid",i()),a.append("token",s("kenzap_token")),a.append("data",e),fetch("https://api-v1.kenzap.cloud/error/",{method:"post",headers:{Accept:"application/json","Content-type":"application/x-www-form-urlencoded"},body:a}),void alert("Can not connect to Kenzap Cloud")}if(401===t.code){if(-1!=window.location.href.indexOf("localhost"))return void alert(t.reason);location.href="https://auth.kenzap.com/?app=65432108792785&redirect="+window.location.href}else alert(t.reason)},l=(t,e)=>{if(document.querySelector(t))for(let a of document.querySelectorAll(t))a.removeEventListener("click",e,!0),a.addEventListener("click",e,!0)},u=(t,e)=>{if(document.querySelector(t))for(let a of document.querySelectorAll(t))a.removeEventListener("keyup",e,!0),a.addEventListener("keyup",e,!0)},p=t=>{if(!document.querySelector(".toast")){let t='\n        <div class="position-fixed bottom-0 p-2 m-4 end-0 align-items-center">\n            <div class="toast hide align-items-center text-white bg-dark border-0" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="3000">\n                <div class="d-flex">\n                    <div class="toast-body"></div>\n                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>\n                </div>\n            </div>\n        </div>';document.querySelector("body > div")&&document.querySelector("body > div").insertAdjacentHTML("afterend",t)}let e=new bootstrap.Toast(document.querySelector(".toast"));document.querySelector(".toast .toast-body").innerHTML=t,e.show()};var m=function(t){return(""+t).length<2?"0"+t:t},v=function(t,e){switch(e=f(e),e=(Math.round(100*parseFloat(e))/100).toFixed(2),t.state.settings.currency_symb_loc){case"left":e=t.state.settings.currency_symb+e;break;case"right":e+=t.state.settings.currency_symb;break;case"left_space":e=t.state.settings.currency_symb+" "+e;break;case"right_space":e=e+" "+t.state.settings.currency_symb}return e},f=function(t){return t=t||0,t=parseFloat(t),t=Math.round(100*t)/100},y=function(t,e,a){var n=(e=parseInt(e))-(a=parseInt(a));if(n<60)return t("moments ago");if(n<3600)return parseInt(n/60)+" "+t("minutes ago");if(n<86400)return parseInt(n/60/60)+" "+t("hours ago");var r=new Date(1e3*a),o=[t("Jan"),t("Feb"),t("Mar"),t("Apr"),t("May"),t("Jun"),t("Jul"),t("Aug"),t("Sep"),t("Oct"),t("Nov"),t("Dec")],i=r.getFullYear(),s=o[r.getMonth()],d=r.getDate();return r.getHours(),r.getMinutes(),r.getSeconds(),a=d+" "+s+" "+i},h=function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},g=function(t,e){var a=e,n={},r=new Date,o=function(t,e){for(var a="",n=32-e,r=0,o=0,i=0,s=0;s<Math.ceil(t.length/n);s++){s>0&&(a+="\n[L]"),o=i=0;for(var d=4;d>-4;d--)if(" "==t[i=(n+r)*s+n+d]||i==t.length){o+=d;break}if(a+=t.substr((n+r)*s,n+o),i==t.length)break;r=o}return a};n.debug=!1,n.print=t.state.settings.receipt_template,console.log(n.print),n.print=n.print.replace(/{{order_id}}/g,a.id),n.print=n.print.replace(/{{date_time}}/g,r.toLocaleString([],{dateStyle:"medium",timeStyle:"short"}));var i="";for(var s in a.items){console.log(__(a.items[s].title));var d=v(t,a.items[s].total),c=(a.items[s].qty+"").length+(d+"").length+3;for(var l in i+="[L]<b>".concat(a.items[s].qty," X ").concat(o(__(a.items[s].title),c),"</b>[R]").concat(d,"\n"),a.items[s].variations){for(var u in i+="[L] ".concat(o(__(a.items[s].variations[l].title),1),":"),a.items[s].variations[l].list)i+=" ".concat(a.items[s].variations[l].list[u].title,",");i.endsWith(",")&&(i=i.substring(0,i.length-1)+"\n")}}i.endsWith("\n")&&(i=i.substring(0,i.length-2)),n.print=n.print.replace(/{{order_items}}/g,i);var p=a.note&&"<br>"!=a.note?a.note:"";p.length>0&&(n.print=n.print.replace(/{{order_note}}/g,"[C]================================\n"+p+"\n[C]================================\n")),n.print=n.print.replace(/{{total}}/g,v(t,a.price.total)),n.print=n.print.replace(/{{tax_total}}/g,v(t,a.price.tax_total)),n.print=n.print.replace(/{{discount_total}}/g,v(t,a.price.discount_total)),n.print=n.print.replace(/{{grand_total}}/g,v(t,a.price.grand_total));var m="";m+="[L]Subtotal[R]"+v(t,a.price.total)+"\n",a.price.discount_total>0&&(m+="[L]"+__("Discount")+"[R]-"+v(t,a.price.discount_total)+"\n"),a.price.fee_total>0&&(m+="[L]"+t.state.settings.fee_display+"[R]"+v(t,a.price.fee_total)+"\n"),a.price.tax_total>0&&(m+="[L]"+t.state.settings.tax_display+"[R]"+v(t,a.price.tax_total)+"\n"),a.price.grand_total>0&&(m+="[L]"+__("Grand Total")+"[R]"+v(t,a.price.grand_total)),n.print=n.print.replace(/{{order_totals}}/g,m),n.print=n.print.replace(/{{qr_link}}/g,"http://"+t.state.qr_settings.slug+".kenzap.site"),n.print=n.print.replace(/{{qr_number}}/g,document.querySelector("#qr-number").value);var f="kenzapprint://kenzapprint.app?data="+encodeURIComponent(JSON.stringify(n));return n.debug&&(console.log(n.print),console.log(f)),f},b={_this:null,renderOrder:function(t,a){var n,r=document.querySelector(".order-modal");t.modalCont=new bootstrap.Modal(r),t.modalOpen=!0;var o=a.currentTarget.dataset.index;history.pushState({pageID:"orders"},"Orders",window.location.pathname+window.location.search+"#editing"),r.addEventListener("hide.bs.modal",(function(t){-1!=window.location.href.indexOf("#editing")&&history.pushState({pageID:"orders"},"Orders",window.location.pathname+window.location.search)})),t.state.orderSingle=void 0===o?{_id:"new",created:1649831099,from:"no name",id:"",idd:"",items:[],kid:"0",name:"no name",note:"",sid:i,status:"new",step:1,table:"1",total:0,updated:1649833845}:t.state.orders[o];var s="";Object.keys(t.state.statuses).forEach((function(e,a){s+='<li><a class="dppi dropdown-item" data-key="'.concat(e,'" href="#">').concat(t.state.statuses[e].text,"</a></li>")}));var d='\n        <div class="d-flex justify-content-between">\n            <div class="st-modal st-opts mb-3 me-1 me-sm-3 dropdown">\n                <a class="btn btn-sm '.concat(t.state.statuses[t.state.orderSingle.status].class,' dropdown-toggle order-form" data-id="status" data-type="key" data-value="').concat(t.state.orderSingle.status,'" href="#" role="button" id="order-status-modal" data-bs-toggle="dropdown" aria-expanded="false" >\n                    ').concat(t.state.statuses[t.state.orderSingle.status].text,'\n                </a>\n                <ul class="dropdown-menu" aria-labelledby="order-status-modal">\n                    ').concat(s,'\n                </ul>\n            </div>\n            <a href="#" data-index="0" class="print-order text-success">\n                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-printer" viewBox="0 0 16 16">\n                    <path d="M2.5 8a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1z"></path>\n                    <path d="M5 1a2 2 0 0 0-2 2v2H2a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h1v1a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-1h1a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-1V3a2 2 0 0 0-2-2H5zM4 3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v2H4V3zm1 5a2 2 0 0 0-2 2v1H2a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v-1a2 2 0 0 0-2-2H5zm7 2v3a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1z"></path>\n                </svg>\n            </a>\n        </div>\n        ');r.querySelector(".modal-dialog").classList.add("modal-fullscreen"),r.querySelector(".modal-header .modal-title").innerHTML=t.state.orderSingle.from,r.querySelector(".modal-footer .btn-confirm").innerHTML="new"==t.state.orderSingle._id?__("Create"):__("Update"),r.querySelector(".btn-confirm").dataset.loading=!1,r.querySelector(".modal-footer .btn-secondary").innerHTML=__("Close");var c=d,u=(e(n={id:{l:__("ID"),classList:"order-form"},from:{l:__("From"),e:"text",editable:!0,classList:"order-form"},items:{l:"",e:"items"},fname:{l:__("Name"),e:"text"},lname:{l:__("Surname"),e:"text"},bios:{l:__("Bios"),e:"textarea"},avatar:{l:__("Avatar"),e:"text"},email:{l:__("Email"),e:"text"},countryr:{l:__("Country"),e:"text"},cityr:{l:__("City"),e:"text"},addr1:{l:__("Address 1"),e:"textarea"},addr2:{l:__("Address 2"),e:"textarea"},post:{l:__("Post"),e:"text"},state:{l:__("State"),e:"text"},c1:{l:__("Whatsapp"),e:"text"},c2:{l:__("Messenger"),e:"text"},c3:{l:__("Line"),e:"text"},c4:{l:__("Email"),e:"text"},c5:{l:__("Telegram"),e:"text"}},"email",{l:__("Email"),e:"text"}),e(n,"bio",{l:__("Bio"),e:"text"}),e(n,"y1",{l:__("Name"),e:"text"}),e(n,"y2",{l:__("IBAN"),e:"text"}),e(n,"y3",{l:__("SWIFT"),e:"text"}),e(n,"y4",{l:__("Bank"),e:"text"}),e(n,"y5",{l:__("Bank city"),e:"text"}),e(n,"y6",{l:__("Bank country"),e:"text"}),e(n,"note",{l:__("Note"),e:"textarea"}),e(n,"total",{l:__("Total"),e:"price",classList:"order-form"}),e(n,"total_tax",{l:__("Tax"),e:"price",classList:"order-form"}),e(n,"total_with_tax",{l:__("Amount Payable"),e:"price",classList:"order-form"}),e(n,"s3",{l:__("Link 3"),e:"text"}),e(n,"company",{l:__("Company"),e:"text"}),e(n,"vat",{l:__("Tax ID"),e:"text"}),e(n,"grade",{l:__("Grade"),e:"text"}),e(n,"kenzap_ida",{l:__("Kenzap IDA"),e:"text"}),n);for(var p in u)if(void 0!==t.state.orderSingle[p]){var m=t.state.orderSingle[p],v=u[p].l;c+='\n            <div class="mb-3 mt-3 order-row keyx-'.concat(p," ").concat("_id"==p||"from"==p?"elipsized":"",'"  >\n                <b>').concat(v,"</b>").concat(b.renderField(t,u[p],m,p),"\n            </div>")}c+="",r.querySelector(".modal-body").innerHTML='<div class="modal-body-cont">'+c+"</div>",t.modalCont.show(),b.tableOrderItemListeners(),b.suggestOrderItem(t),r.querySelector(".edit-item").addEventListener("blur",(function(t){setTimeout((function(){document.querySelector(".s-list").dataset.toggle=!1}),500)})),b.addOrderItem(t),"new"==t.state.orderSingle._id&&b.refreshTotals(),"new"==t.state.orderSingle._id&&setTimeout((function(){document.querySelector(".edit-item").focus()}),300),l(".print-order",(function(e){e.preventDefault(),(t=>{let e=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window});t.dispatchEvent(e)})(r.querySelector(".btn-confirm")),t.state.printLink=!0})),t.listeners.modalSuccessBtnFunc=function(e){e.preventDefault(),t.updateOrder(o,t.state.orderSingle._id)},l(".st-modal li a",(function(e){e.preventDefault();var a=document.querySelector("#order-status-modal");a.innerHTML=t.state.statuses[e.currentTarget.dataset.key].text,a.dataset.value=e.currentTarget.dataset.key;Object.keys(t.state.statuses).forEach((function(e){t.state.statuses[e].class.split(" ").forEach((function(t){a.classList.remove(t)}))})),t.state.statuses[e.currentTarget.dataset.key].class.split(" ").forEach((function(t){a.classList.add(t)}))}))},newOrder:function(t){b._this=t,l(".add-order",(function(e){b.renderOrder(t,e)}))},viewOrder:function(t){b._this=t,l(".view-order",(function(e){b.renderOrder(t,e)}))},renderField:function(t,e,a,n){var r="";switch(e.e){case"price":return r='<div data-id="'.concat(n,'" data-type="key-number" class="').concat(e.classList?e.classList:"",' ms-2 d-inline-block" ').concat(e.editable?'contenteditable="true"':"",' data-id="').concat(n,'" data-value="').concat(a,'">').concat(v(t,a),"</div>");case"text":return r='<div data-id="'.concat(n,'" data-type="text" class="').concat(e.classList?e.classList:"",' ms-2 d-inline-block" ').concat(e.editable?'contenteditable="true"':"",' data-id="').concat(n,'">').concat(a,"</div>");case"textarea":return'<textarea type="text" rows="4" class="form-control order-form pv " data-type="textarea" id="'+n+'" value="'+a+'">'+a+"</textarea>";case"items":for(var o in r='<table class="items order-form" data-type="items"><tr><th><div class="me-1 me-sm-3">'.concat(__("Product"),'</div></th><th class="qty"><div class="me-1 me-sm-3">').concat(__("Qty"),'</div></th><th class="tp"><div class="me-1 me-sm-3">').concat(__("Total"),"</div></th><th></th></tr>"),a)r+=b.structOrderItemTable(t,o,a,!1);return r+='<tr class="new-item-row">\n                            <td>\n                                <div class="me-1 me-sm-3">\n                                    <input type="text" value="" autocomplete="off" placeholder="'.concat(__("Search.."),'" class="form-control edit-item" data-id="" data-index="" list="item-suggestions">\n                                    <span class="select-list-group__toggle"> </span>\n                                    <ul class="s-list my-1 shadow-sm" data-toggle="false"></ul>\n                                    <datalist id="item-suggestions" class="fs-12 d-none"></datalist>\n                                </div>\n                            </td>\n                            <td class="qty">\n                                <div class="me-1 me-sm-3">\n                                    <input type="text" value="" autocomplete="off" class="form-control text-right edit-qty">\n                                </div>\n                            </td>\n                            <td class="tp">\n                                <div class="me-1 me-sm-3">\n                                    <input type="text" value="" autocomplete="off" class="form-control edit-tp">\n                                </div>\n                            </td>\n                            <td class="align-middle text-center"> \n                                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16" width="24" height="24" class="bi bi-plus-circle text-success align-middle add-item"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"></path><path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"></path></svg>\n                            </td>\n                        </tr>'),r+='</table><div class="item-vars-input mt-3"> </div>';default:return"_id"==n&&(a=a.substr(0,6)),r='<div data-id="'.concat(n,'" data-type="text" class="').concat(e.classList?e.classList:"",' ms-2 d-inline-block" ').concat(e.editable?'contenteditable="true"':"",' data-id="').concat(n,'">').concat(a,"</div>")}},itemOptions:function(t){return'\n\n        <div class="dropdown text-center">\n            <a  href="#" role="button" id="order-item-options" data-id="status" data-value="" data-bs-toggle="dropdown" aria-expanded="false">\n                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-three-dots-vertical order-item-options" viewBox="0 0 16 16"><path d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/></svg>\n            </a>\n            <ul class="dropdown-menu" aria-labelledby="order-item-options" >\n                <li><a class="oio dropdown-item edit-item-note" data-key="edit-item-note" href="#">'.concat(__("Add note"),'</a></li>\n                <li><a class="oio dropdown-item d-none" data-key="edit-item-variation" href="#">').concat(__("Add variation"),'</a></li>\n                <li><a class="oio dropdown-ite d-none" data-key="edit-item-price" href="#">').concat(__("Adjust price"),'</a></li>\n                <li><a class="oio dropdown-item text-danger remove-item" data-key="remove-item" href="#">').concat(__("Remove"),"</a></li>\n            </ul>\n        </div>\n    ")},structOrderItemTable:function(t,e,a){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o="",i="";for(var s in a[e].variations){var d="";for(var c in a[e].variations[s].list)d+=a[e].variations[s].list[c].title+" ";o+="<div><b>"+a[e].variations[s].title+"</b> <span>"+d+"</span></div> ",void 0!==a[e].variations[s].note&&a[e].variations[s].note.length>0&&(o+="<div><b>"+__("Note")+"</b> "+a[e].variations[s].note+"</div> ")}return i+='<tr class="order-item-row-active" data-x="'+e+'" data-id="'+a[e].id+'" data-vars="'+h(JSON.stringify(a[e].variations))+'">',i+='<td ><div class="item-title" contenteditable="false" data-value="'+a[e].title+'" data-sdesc="'+(a[e].sdesc?a[e].sdesc:"")+'">'+a[e].title+'</div><div class="item-note text-muted mb-1 '+(0!=a[e].note.length&&"<br>"!=a[e].note||n?"":"d-none")+'" contenteditable="true" data-value="'+a[e].note+'">'+a[e].note+'</div><div class="vars border-primary item-variations my-1 ps-2 text-secondary" data-value="">'+o+'</div></td><td class="qty"><div class="me-1 me-sm-3 item-qty" data-value="'+a[e].qty+'">'+a[e].qty+'</div></td><td class="tp"><div class="me-1 me-sm-3 item-total" data-price="'+a[e].price+'" data-value="'+a[e].total+'" >'+v(t,a[e].total)+'</div><td class="'+(r?"":"d-none")+'">'+b.itemOptions(a[e])+"</td></td>",i+="</tr>"},suggestOrderItem:function(e){u(".edit-item",(function(a){var n=a.keyCode||a.charCode;if(!(n>=34&&n<=45)){var o,i,s=a.currentTarget.value;if(1==s.length&&document.querySelector(".modal-body").scrollTo({top:document.querySelector(".edit-item").getBoundingClientRect().top-document.querySelector(".modal-body-cont").getBoundingClientRect().top-20,behavior:"smooth"}),0!=s.length&&a.currentTarget===document.activeElement)fetch("https://api-v1.kenzap.cloud/",{method:"post",headers:d,body:JSON.stringify({query:{products:{type:"find",key:"ecommerce-product",fields:["_id","id","img","status","variations","price","title"],limit:e.state.slist,term:[{type:"string",field:"status",relation:"=",value:"1"}],offset:s.length>0?0:(o=new URLSearchParams(window.location.search),i=o.get("page")?o.get("page"):1,parseInt(i)*e.state.slist-e.state.slist),search:{field:"title",s:s},sortby:{field:"title",order:"DESC"}}}})}).then((function(t){return t.json()})).then((function(a){if(r(),a.success){e.state.productsSuggestions=a.products;var n="";a.products.forEach((function(t,e){n+='<li class="s-list-item py-1" data-id="'.concat(t._id,'" data-title="').concat(t.title,'" data-index="').concat(e,'"  data-display="true" data-highlight="false">').concat(t.title,"</li>")})),document.querySelector(".s-list").innerHTML=n,document.querySelector(".s-list").dataset.toggle=!0,l(".s-list-item",(function(a){var n=a.currentTarget.dataset.index;document.querySelector(".edit-item").dataset.index=n,document.querySelector(".edit-item").dataset.id=e.state.productsSuggestions[n]._id,document.querySelector(".edit-item").value=e.state.productsSuggestions[n].title,document.querySelector(".edit-qty").value=1,document.querySelector(".edit-qty").dataset.price=e.state.productsSuggestions[n].price,document.querySelector(".edit-tp").value=e.state.productsSuggestions[n].price,document.querySelector(".edit-tp").dataset.price=e.state.productsSuggestions[n].price,document.querySelector(".s-list").dataset.toggle=!1;document.querySelector(".edit-qty").addEventListener("keypress",(function(t){if(8!=t.which&&isNaN(String.fromCharCode(t.which)))return t.preventDefault(),!1})),document.querySelector(".edit-qty").addEventListener("keydown",(function(t){setTimeout((function(){var t;t=parseFloat(document.querySelector(".edit-qty").value)*parseFloat(document.querySelector(".edit-qty").dataset.price),isNaN(t)&&(t=""),document.querySelector(".edit-tp").value=t}),300)})),document.querySelector(".edit-tp").addEventListener("keypress",(function(t){if(8!=t.which&&46!=t.which&&isNaN(String.fromCharCode(t.which)))return t.preventDefault(),!1})),document.querySelector(".edit-qty").focus(),document.querySelector(".edit-qty").select(),document.querySelector(".item-vars-input").innerHTML=function(e,a){var n="";if(t("undefined"!==a.variations))for(var r in a.variations){var o="";for(var i in"checkbox"==a.variations[r].type&&(o="check"),"radio"==a.variations[r].type&&(o="radio"),n+="        <b>"+__(a.variations[r].title)+("1"==a.variations[r].required?' <span class="tag">'+__("required")+"</span>":"")+'</b>        <div class="kp-'+o+'" >',a.variations[r].data)switch(a.variations[r].data[i].price=f(a.variations[r].data[i].price),o){case"check":n+='                    <label>                        <input type="checkbox" data-required="'+a.variations[r].required+'" data-indexv="'+r+'" data-index="'+i+'" data-title="'+a.variations[r].data[i].title+'" data-titlev="'+__(a.variations[r].title)+'" data-price="'+a.variations[r].data[i].price+'" >                        <div class="checkbox">                            <svg width="20px" height="20px" viewBox="0 0 20 20">                                <path d="M3,1 L17,1 L17,1 C18.1045695,1 19,1.8954305 19,3 L19,17 L19,17 C19,18.1045695 18.1045695,19 17,19 L3,19 L3,19 C1.8954305,19 1,18.1045695 1,17 L1,3 L1,3 C1,1.8954305 1.8954305,1 3,1 Z"></path>                                <polyline points="4 11 8 15 16 6"></polyline>                            </svg>                        </div>                        <span>'+__(a.variations[r].data[i].title)+'</span>                        <div class="price">+ '+v(e,a.variations[r].data[i].price)+"</div>                    </label>";break;case"radio":n+='                    <label>                        <input type="radio" data-required="'+a.variations[r].required+'" data-indexv="'+r+'" name="radio'+r+'" data-index="'+i+'" data-title="'+a.variations[r].data[i].title+'" data-titlev="'+__(a.variations[r].title)+'" data-price="'+a.variations[r].data[i].price+'"  />                        <span>'+__(a.variations[r].data[i].title)+'</span>                        <div class="price">+ '+v(e,a.variations[r].data[i].price)+"</div>                    </label>"}n+="</div>"}return n}(e,e.state.productsSuggestions[n])}))}else c(a)})).catch((function(t){console.log(t),c(t)}));else document.querySelector(".s-list").dataset.toggle=!1}}))},tableOrderItemListeners:function(t){l(".edit-item-note",(function(t){t.preventDefault();var e=t.currentTarget.parentElement.parentElement.parentElement.parentElement.parentElement.querySelector(".item-note");console.log(e),e.classList.remove("d-none"),e.focus()})),l(".remove-item",(function(t){t.preventDefault(),t.currentTarget.parentElement.parentElement.parentElement.parentElement.parentElement.remove(),b.refreshTotals()}))},refreshTotals:function(){document.querySelector(".order-total")&&document.querySelector(".order-total").remove(),document.querySelector(".keyx-total")&&document.querySelector(".keyx-total").remove(),document.querySelector(".keyx-total_tax")&&document.querySelector(".keyx-total_tax").remove(),document.querySelector(".keyx-total_with_tax")&&document.querySelector(".keyx-total_with_tax").remove();var t,e="",a={total:{title:__("Total"),amount:0},total_tax:{title:__("Tax"),amount:0},total_with_tax:{title:__("Paid"),amount:0}},r=n(document.querySelectorAll(".item-total"));try{for(r.s();!(t=r.n()).done;){var o=t.value,i=.09*f(o.dataset.value);a.total.amount+=f(o.dataset.value),a.total_tax.amount+=i,a.total_with_tax.amount+=f(o.dataset.value)+i}}catch(t){r.e(t)}finally{r.f()}for(var s in a){var d=a[s].title;"total_tax"==s&&(d=b._this.state.settings.tax_display+" ("+b._this.state.settings.tax_rate+"%):"),e+='\n        <div class="mb-3 mt-3 order-row elipsized keyx-'.concat(s,'">\n            <b>').concat(d,'</b><div class="order-form ms-2 d-inline-block" data-id="').concat(s,'" data-type="key-number" data-value="').concat(a[s].amount,'">').concat(v(b._this,a[s].amount),"</div>\n        </div>")}e='<div class="order-total">'.concat(e,"</div>"),document.querySelector(".modal-body-cont").insertAdjacentHTML("beforeend",e)},addOrderItem:function(t){l(".add-item",(function(e){var a=[],r={};r.id=document.querySelector(".edit-item").dataset.id,r.title=document.querySelector(".edit-item").value,r.total=parseFloat(document.querySelector(".edit-tp").value),r.price=parseInt(document.querySelector(".edit-tp").dataset.price),r.qty=parseInt(document.querySelector(".edit-qty").value),r.note="",r.variations=[];var o,i=0,s=n(document.querySelectorAll(".item-vars-input input"));try{for(s.s();!(o=s.n()).done;){var d=o.value,c=i;d.checked&&(r.variations[c]||(r.variations[c]={}),r.variations[c].list||(r.variations[c].list={}),r.variations[c].title||(r.variations[c].title=d.dataset.titlev),r.variations[c].list["_"+d.dataset.index]={title:d.dataset.title,price:parseFloat(d.dataset.price)},r.total+=r.qty*parseFloat(d.dataset.price),i+=1)}}catch(t){s.e(t)}finally{s.f()}if(r.title.length<2)alert(__("Incorrect product data"));else{a.push(r);var l=b.structOrderItemTable(t,0,a,!0);document.querySelector(".new-item-row").insertAdjacentHTML("beforebegin",l),b.tableOrderItemListeners(),b.refreshTotals(),document.querySelector(".edit-item").value="",document.querySelector(".edit-tp").value="",document.querySelector(".edit-qty").value="",document.querySelector(".item-vars-input").innerHTML="",setTimeout((function(){document.querySelector(".edit-item").focus()}),300)}}))}},_={viewOrder:function(t){_._this=t,l(".print-order",(function(e){_.renderOrder(t,e)}))},renderOrder:function(t,e){e.preventDefault();var a=new Date,n=e.currentTarget.dataset.index;t.state.orderSingle=t.state.orders[n];var r=t.state.orders[n];r.entity="Fu Zhen Seafood";var o={};o.print=t.state.settings.receipt_template,o.print=o.print.replace(/{{order_id_short}}/g,r.id.substr(0,5)),o.print=o.print.replace(/{{date_time}}/g,a.toLocaleString([],{dateStyle:"medium",timeStyle:"short"}));var i="";for(var s in r.items)for(var d in i+="[L]<b>".concat(r.items[s].qty," X ").concat(r.items[s].title,"</b>[R]").concat(v(t,r.items[s].total),"\n"),r.items[s].variations){for(var c in i+="[L]| ".concat(r.items[s].variations[d].title,":"),r.items[s].variations[d].list)i+=" ".concat(r.items[s].variations[d].list[c].title,",");i.endsWith(",")&&(i=i.substring(0,i.length-1)+"\n")}i.endsWith("\n")&&(i=i.substring(0,i.length-2)),o.print=o.print.replace(/{{order_items}}/g,i);var l=0==r.note.length||"<br>"==r.note?"":r.note;return l.length>0&&(o.print=o.print.replace(/{{order_note}}/g,"[C]================================\n"+l+"\n[C]================================\n")),o.print=o.print.replace(/{{total}}/g,v(t,r.price.total)),o.print=o.print.replace(/{{total_tax}}/g,v(t,r.price.tax_total)),o.print=o.print.replace(/{{grand_total}}/g,v(t,r.price.grand_total)),o.debug=!1,console.log("kenzapprint://kenzapprint.app?data="+encodeURIComponent(JSON.stringify(o))),p(__("Printing j")),location.href="kenzapprint://kenzapprint.app?data="+encodeURIComponent(JSON.stringify(o)),!1}},S={state:{firstLoad:!0,firstTouch:!0,modalCont:null,modalOpen:!1,playSoundNow:!1,newOrderCount:0,orderIDs:[],printLink:null,orders:[],settings:{},orderSingle:[],playTitleTimer:null,refreshTimer:null,statuses:[],audio:new Audio("https://kenzap.com/static/swiftly.mp3"),limit:50,slistLimit:10,productsSuggestions:[]},init:function(){S.getData(),S.state.refreshTimer=setInterval((function(){S.getDataNew()}),1e4)},getDataNew:function(){fetch("https://api-v1.kenzap.cloud/",{method:"post",headers:d,body:JSON.stringify({query:{orders:{type:"find",key:"ecommerce-order",fields:"*",term:[{type:"string",field:"status",relation:"=",value:"new"},{type:"string",field:"status",relation:"=",value:"paid"}],limit:1}}})}).then((function(t){return t.json()})).then((function(t){t.success&&t.orders.length&&(console.log(t.orders),S.getData())})).catch((function(t){}))},getData:function(){S.state.firstLoad&&(()=>{let t=document.querySelector(".loader");t&&(t.style.display="block")})(),S.state.printLink&&(window.location.href=S.state.printLink,S.state.printLink=null);var t=document.querySelector(".search-input")?document.querySelector(".search-input").value:"",e=document.querySelector("#order-status")?document.querySelector("#order-status").dataset.value:"";fetch("https://api-v1.kenzap.cloud/",{method:"post",headers:d,body:JSON.stringify({query:{user:{type:"authenticate",fields:["avatar"],token:s("kenzap_token")},locale:{type:"locale",source:["extension"],key:"ecommerce"},orders:{type:"find",key:"ecommerce-order",fields:"*",term:""!=e?"status='"+e+"'":"",limit:S.state.limit,search:{field:"from",s:t},sortby:{field:"created",order:"DESC"}},settings:{type:"get",key:"ecommerce-settings",fields:["currency","currency_symb","currency_symb_loc","tax_calc","tax_auto_rate","tax_rate","tax_display","receipt_template"]}}})}).then((function(t){return t.json()})).then((function(t){r(),t.success?((t=>{if(t.header&&localStorage.setItem("header",t.header),!document.querySelector("#k-script")){let t=document.createElement("div");t.innerHTML=localStorage.getItem("header"),t=t.firstChild,document.body.prepend(t),Function(document.querySelector("#k-script").innerHTML).call("test")}t.locale&&window.i18n.init(t.locale)})(t),S.loadPageStructure(),S.renderPage(t),S.initListeners(),S.initFooter(),S.state.firstLoad=!1):c(t)})).catch((function(t){c(t)}))},authUser:function(t){t.user&&t.user.success},loadPageStructure:function(){S.state.firstLoad&&(document.querySelector("#contents").innerHTML=function(t){return'\n      <div class="container ec-orders">\n        <div class="d-md-flex justify-content-between bd-highlight mb-3">\n            <nav class="bc" aria-label="breadcrumb"></nav>\n            <button class="btn btn-primary add-order btn-add mt-3 mb-1 mt-md-0 mb-md-0" type="button">'.concat(t("New order"),'</button>\n        </div>\n        <div class="row">\n          <div class="col-md-12 page-title">\n            <div class="st-opts st-table mb-3 dropdown">\n                <a class="btn btn-outline-secondary dropdown-toggle" href="#" role="button" id="order-status" data-id="status" data-value="" data-bs-toggle="dropdown" aria-expanded="false">\n                  ').concat(t("All"),'\n                </a>\n                <ul class="dropdown-menu" aria-labelledby="order-status">\n                  <li><a class="dppi dropdown-item" data-key="" href="#" >').concat(t("All"),'</a></li>\n                  <li><a class="dppi dropdown-item" data-key="new" href="#" >').concat(t("New"),'</a></li>\n                  <li><a class="dppi dropdown-item" data-key="paid" href="#" >').concat(t("Paid"),'</a></li>\n                  <li><a class="dppi dropdown-item" data-key="processing" href="#" >').concat(t("Processing"),'</a></li>\n                  <li><a class="dppi dropdown-item" data-key="completed" href="#" >').concat(t("Completed"),'</a></li>\n                  <li><a class="dppi dropdown-item" data-key="canceled" href="#" >').concat(t("Canceled"),'</a></li>\n                  <li><a class="dppi dropdown-item" data-key="failed" href="#" >').concat(t("Failed"),'</a></li>\n                  <li><a class="dppi dropdown-item" data-key="refunded" href="#" >').concat(t("Refunded"),'</a></li>\n                </ul>\n            </div>\n            <div class="st-opts" >\n              <div class="input-group-sm mb-0 justify-content-start mb-3 mb-sm-0" >\n                <input id="usearch" type="text" class="inp form-control search-input" autocomplete="off" placeholder="').concat(t("Search order"),'">\n              </div>\n              \x3c!-- <a id="viewSum" href="#" style="margin-left:16px;">view summary</a> --\x3e\n            </div>\n          </div>\n        </div>\n\n        <div class="row">\n          <div class="col-md-12 grid-margin grid-margin-lg-0 grid-margin-md-0 stretch-card">\n            <div class="card border-white shadow-sm border-0">\n              <div class="card-body p-0">\n \n                <div class="table-responsive">\n                  <table class="table table-hover table-borderless align-middle table-striped table-p-list mb-0">\n                    <thead>\n                      <tr>\n                        <th><span class="ps-1">').concat(t("From"),'</span></th>\n                        <th class="d-none d-sm-table-cell">').concat(t("Status"),"</th>\n                        <th>").concat(t("Total"),'</th>\n                        <th class="d-none d-sm-table-cell">').concat(t("Time"),'</th>\n                        <th></th>\n                      </tr>\n                    </thead>\n                    <tbody class="list">\n\n                    </tbody>\n                  </table>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div class="modal order-modal" tabindex="-1" data-backdrop="static" data-keyboard="false">\n        <div class="modal-dialog ">\n          <div class="modal-content">\n              <div class="modal-header">\n                <h5 class="modal-title"></h5>\n                <button type="button" class="btn-close align-self-start-remove" data-bs-dismiss="modal" aria-label="Close"></button>\n              </div>\n              <div class="modal-body">\n              \n              </div>\n              <div class="modal-footer">\n                <button type="button" class="btn btn-primary btn-confirm"></button>\n                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"></button>\n              </div>\n          </div>\n        </div>\n      </div>\n\n    ')}(__))},renderPage:function(t){if(S.state.firstLoad&&((t=>{let e='<ol class="breadcrumb mt-2 mb-0">';for(let a of t)void 0===a.link?e+=`<li class="breadcrumb-item">${a.text}</li>`:e+=`<li class="breadcrumb-item"><a href="${a.link}">${a.text}</a></li>`;e+="</ol>",document.querySelector(".bc").innerHTML=e})([{link:o("https://dashboard.kenzap.cloud"),text:__("Dashboard")},{link:o("/"),text:__("E-commerce")},{text:__("Orders")}]),S.state.statuses={new:{text:__("New"),class:"btn-warning text-dark fw-light"},paid:{text:__("Paid"),class:"btn-primary fw-light"},processing:{text:__("Processing"),class:"btn-primary fw-light"},completed:{text:__("Completed"),class:"btn-success fw-light"},canceled:{text:__("Canceled"),class:"btn-secondary fw-light"},failed:{text:__("Failed"),class:"btn-danger fw-light"},refunded:{text:__("Refunded"),class:"btn-danger fw-light"}}),S.state.orders=t.orders,S.state.settings=t.settings,0!=t.orders.length){var e=[];S.state.newOrderCount=[];var a="",n=0;for(var r in t.orders){e.push(t.orders[r]._id),void 0===t.orders[r].status&&(t.orders[r].status="new"),"new"==t.orders[r].status&&n++;var i=S.state.orderIDs.includes(t.orders[r]._id)||S.state.firstLoad?"":"new";a+='\n            <tr class="'.concat(i,'">\n              <td class="details">\n                <div class="ps-1 view-order" data-id="').concat(t.orders[r]._id,'" data-index="').concat(r,'">\n                  <b class="">').concat(t.orders[r].id,"</b> ").concat(t.orders[r].from,'\n                  <div class=" elipsized fst-italic">').concat(t.orders[r].note?t.orders[r].note:"",'</div>\n                  <div class=" d-sm-none"> <span class="me-2">').concat(S.getStatus(t.orders[r].status),'</span> <span class="text-muted">').concat(y(__,t.meta.time,t.orders[r].created),'</span> </div>\n                </div>\n              </td>\n              <td class="d-none d-sm-table-cell">\n                <span class="fs-12">').concat(S.getStatus(t.orders[r].status),'</span>\n              </td>\n              <td>\n                <span style="font-size:18px;">').concat(v(S,t.orders[r].total),'</span>\n              </td>\n              <td class="d-none d-sm-table-cell">\n                <span style="font-size:18px;">').concat(y(__,t.meta.time,t.orders[r].created),'</span>\n              </td>\n              <td class="last">\n                <a href="#" data-id="').concat(t.orders[r]._id,'" data-index="').concat(r,'" class="view-order text-success d-none me-4"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-eye" viewBox="0 0 16 16">\n                    <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z"/>\n                    <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z"/>\n                </svg></a>\n                <a href="kenzapprint://kenzapprint.app?data=').concat(encodeURIComponent(JSON.stringify({print:'[C]<u><font size="big">ORDER{{order_id_short}}</font></u>\n[C]Fu Zhen Seafood\n[C]<u type=double>{{date_time}}</u>\n[C]\n[C]================================" \n[L]\n[L]<b>BEAUTIFUL SHIRT</b>[R]9.99€\n[L]  + Size : S\n[L]\n[L]<b>AWESOME HAT</b>[R]24.99€\n[L]  + Size : 57/58\n[L]\n[C]--------------------------------\n[R]TOTAL PRICE :[R]34.98€\n[R]TAX :[R]4.23€'})),'" data-id="').concat(t.orders[r]._id,'" data-index="').concat(r,'" class="print-order-dis d-none text-success me-2">\n                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-printer me-2" viewBox="0 0 16 16">\n                    <path d="M2.5 8a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1z"/>\n                    <path d="M5 1a2 2 0 0 0-2 2v2H2a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h1v1a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-1h1a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-1V3a2 2 0 0 0-2-2H5zM4 3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v2H4V3zm1 5a2 2 0 0 0-2 2v1H2a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v-1a2 2 0 0 0-2-2H5zm7 2v3a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1z"/>\n                </svg></a>\n                <a href="#" data-id="').concat(t.orders[r]._id,'" data-index="').concat(r,'" class="remove-order text-danger me-2"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">\n                    <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>\n                    <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>\n                </svg></a>\n              </td>\n            </tr>')}S.state.playSoundNow=n>0,S.state.orderIDs=e,document.querySelector(".table tbody").innerHTML=a}else document.querySelector(".table tbody").innerHTML='<tr><td colspan="5">'.concat(__("No orders to display."),"</td></tr>")},getStatus:function(t){return'<div class="badge '.concat(S.state.statuses[t].class,'">').concat(S.state.statuses[t].text,"</div>")},playSound:function(){console.log("playSound"),S.state.audio.play()},playTitle:function(t){},initListeners:function(){b.viewOrder(S),l(".remove-order",S.listeners.removeOrder),_.viewOrder(S),l(".st-table li a",S.listeners.changeStatus),S.state.firstLoad&&(b.newOrder(S),l(".modal .btn-primary",S.listeners.modalSuccessBtn),u(".search-input",S.listeners.searchOrders),document.body.addEventListener("touchstart",(function(){S.state.firstTouch?(S.state.audio.play(),S.state.audio.pause(),S.state.audio.currentTime=0,S.state.firstTouch=!1):(S.state.playTitleTimer&&clearInterval(S.state.playTitleTimer),S.state.playTitleTimer=setInterval((function(){S.state.playSoundNow&&S.playSound()}),6500))}),!1),window.addEventListener("hashchange",(function(t){if(S.modalCont)return t.preventDefault(),S.modalOpen=!1,S.modalCont.hide(),!1})))},listeners:{newOrder:function(t){},changeStatus:function(t){t.preventDefault();var e=document.querySelector("#order-status");""==t.currentTarget.dataset.key?(e.innerHTML=__("All"),e.dataset.value=""):(e.innerHTML=S.state.statuses[t.currentTarget.dataset.key].text,e.dataset.value=t.currentTarget.dataset.key);Object.keys(S.state.statuses).forEach((function(t){S.state.statuses[t].class.split(" ").forEach((function(t){e.classList.remove(t)}))})),""==t.currentTarget.dataset.key?e.classList.add("btn-primary"):S.state.statuses[t.currentTarget.dataset.key].class.split(" ").forEach((function(t){e.classList.add(t)})),S.getData()},removeOrder:function(t){t.preventDefault(),confirm(__("Completely remove this order?"))&&fetch("https://api-v1.kenzap.cloud/",{method:"post",headers:d,body:JSON.stringify({query:{product:{type:"delete",key:"ecommerce-order",id:t.currentTarget.dataset.id,sid:i()}}})}).then((function(t){return t.json()})).then((function(t){t.success?S.getData():c(t)})).catch((function(t){c(t)}))},searchOrders:function(t){t.preventDefault(),S.getData()},modalSuccessBtn:function(t){S.listeners.modalSuccessBtnFunc(t)},modalSuccessBtnFunc:null},updateOrder:function(t,e){var a=document.querySelector(".modal");if("true"!==a.querySelector(".btn-confirm").dataset.loading){a.querySelector(".btn-confirm").dataset.loading=!0,a.querySelector(".btn-confirm").innerHTML='<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>'+__("Loading..");var r,o={},s=n(document.querySelectorAll(".order-form"));try{for(s.s();!(r=s.n()).done;){var l=r.value;switch(l.dataset.type){case"key":o[l.dataset.id]=l.dataset.value;break;case"key-number":o[l.dataset.id]=f(l.dataset.value);break;case"items":o.items=[];var u,v=n(document.querySelectorAll(".order-item-row-active"));try{for(v.s();!(u=v.n()).done;){var y=u.value,h=JSON.parse(y.dataset.vars.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&amp;/g,"&"));o.items.push({id:y.dataset.id,qty:parseInt(y.querySelector(".item-qty").dataset.value),note:y.querySelector(".item-note").innerHTML,type:"new",index:"0",price:parseFloat(y.querySelector(".item-total").dataset.price),sdesc:y.querySelector(".item-title").dataset.sdesc,title:y.querySelector(".item-title").dataset.value,total:parseFloat(y.querySelector(".item-total").dataset.value),variations:"new"==e?[]:h||[]})}}catch(t){v.e(t)}finally{v.f()}break;case"text":o[l.dataset.id]=l.innerHTML;break;case"email":case"emails":case"select":case"textarea":o[l.id]=l.value;break;case"radio":o[l.id]=l.parentElement.parentElement.parentElement.parentElement.parentElement.querySelector("input:checked").value}}}catch(t){s.e(t)}finally{s.f()}var b=new Date;o.created_ymd=b.getUTCFullYear()+""+m(b.getUTCMonth()+1)+m(b.getUTCDate()),o.created_ym=b.getUTCFullYear()+""+m(b.getUTCMonth()+1),o.created_y=b.getUTCFullYear()+"","new"==e?(o.name=o.from,o.customer={first_name:o.from,last_name:"",kid:0},fetch("https://api-v1.kenzap.cloud/",{method:"post",headers:d,body:JSON.stringify({query:{settings:{type:"get",key:"ecommerce-settings",fields:["last_order_id"]}}})}).then((function(t){return t.json()})).then((function(t){t.success?(o.id=f(t.settings.last_order_id)+1,fetch("https://api-v1.kenzap.cloud/",{method:"post",headers:d,body:JSON.stringify({query:{order:{type:"create",key:"ecommerce-order",sid:i(),data:o}}})}).then((function(t){return t.json()})).then((function(t){t.success?(S.modalCont.hide(),p(__("Order created")),S.state.printLink&&(S.state.printLink=g(S,o)),S.getData()):c(t)})).catch((function(t){c(t)})),fetch("https://api-v1.kenzap.cloud/",{method:"post",headers:d,body:JSON.stringify({query:{settings:{type:"set",key:"ecommerce-settings",sid:i(),data:{last_order_id:o.id}}}})}).then((function(t){return t.json()})).then((function(t){t.success||c(t)})).catch((function(t){c(t)}))):c(t)})).catch((function(t){c(t)}))):fetch("https://api-v1.kenzap.cloud/",{method:"post",headers:d,body:JSON.stringify({query:{order:{type:"update",key:"ecommerce-order",sid:i(),id:e,data:o}}})}).then((function(t){return t.json()})).then((function(t){t.success?(S.modalCont.hide(),p(__("Order updated")),S.state.printLink&&(S.state.printLink=g(S,o)),S.getData()):c(t)})).catch((function(t){c(t)}))}},initFooter:function(){var t,e;t=__("Created by %1$Kenzap%2$. ❤️ Licensed %3$GPL3%4$.",'<a class="text-muted" href="https://kenzap.com/" target="_blank">',"</a>",'<a class="text-muted" href="https://github.com/kenzap/ecommerce" target="_blank">',"</a>"),e="",document.querySelector("footer .row").innerHTML=`\n    <div class="d-sm-flex justify-content-center justify-content-sm-between">\n        <span class="text-muted text-center text-sm-left d-block d-sm-inline-block">${t}</span>\n        <span class="float-none float-sm-right d-block mt-1 mt-sm-0 text-center text-muted">${e}</span>\n    </div>`}};S.init()}();
